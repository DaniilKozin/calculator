# ðŸš€ Zenex RevShare Pool Calculator

[![Streamlit App](https://static.streamlit.io/badges/streamlit_badge_black_white.svg)](https://your-app-name.streamlit.app)

Ð˜Ð½Ñ‚ÐµÑ€Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð´Ð°ÑˆÐ±Ð¾Ñ€Ð´ Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° Ð´Ð¾Ñ…Ð¾Ð´Ð½Ð¾ÑÑ‚Ð¸ Ð¿ÑƒÐ»Ð¾Ð² Zenex Ñ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ñ€Ð°Ð·Ð½Ñ‹Ñ… Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð¾Ð² Ð¸ Ñ€Ð°ÑÑ‡ÐµÑ‚Ð° Ð²Ñ‹Ð¿Ð»Ð°Ñ‚ Ð¸Ð½Ð²ÐµÑÑ‚Ð¾Ñ€Ð°Ð¼.

## âœ¨ ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸

- ðŸ“Š **ÐÐ½Ð°Ð»Ð¸Ð· Ð´Ð¾Ñ…Ð¾Ð´Ð½Ð¾ÑÑ‚Ð¸** Stable Ð¸ Growth Ð¿ÑƒÐ»Ð¾Ð²
- ðŸ’° **Ð Ð°ÑÑ‡ÐµÑ‚ Ð²Ñ‹Ð¿Ð»Ð°Ñ‚** per-ZNX Ð´Ð»Ñ Ñ€Ð°Ð·Ð½Ñ‹Ñ… Ñ‚Ð¸Ñ€Ð¾Ð² Ð¸Ð½Ð²ÐµÑÑ‚Ð¾Ñ€Ð¾Ð²
- ðŸ“ˆ **ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð±ÐµÐ·ÑƒÐ±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ð¾ÑÑ‚Ð¸** (295% GGR/Spent, 34% Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ Stable)
- ðŸŽ›ï¸ **ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²** Ñ‡ÐµÑ€ÐµÐ· Ð¸Ð½Ñ‚ÑƒÐ¸Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ UI
- ðŸ“… **Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…** Ð´Ð»Ñ Ñ€Ð°Ð·Ð½Ñ‹Ñ… Ð¼ÐµÑÑÑ†ÐµÐ²
- ðŸ”’ **High Watermark ÑÐ¸ÑÑ‚ÐµÐ¼Ð°** Ð·Ð°Ñ‰Ð¸Ñ‚Ñ‹ ÐºÐ°Ð¿Ð¸Ñ‚Ð°Ð»Ð° Ð¸Ð½Ð²ÐµÑÑ‚Ð¾Ñ€Ð¾Ð²
- ðŸ“‹ **Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…** Ð² CSV Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ

## ðŸƒâ€â™‚ï¸ Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚

### Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð·Ð°Ð¿ÑƒÑÐº

```bash
# ÐšÐ»Ð¾Ð½Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹
git clone https://github.com/DaniilKozin/calculator.git
cd calculator

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
pip install -r requirements.txt

# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
streamlit run dashboard_app.py
```

ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ: http://localhost:8501

## Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð½Ð° Streamlit Community Cloud (Ð‘Ð•Ð¡ÐŸÐ›ÐÐ¢ÐÐž)

### Ð¨Ð°Ð³ 1: ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° GitHub Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ

1. Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ Ð½Ð° [GitHub](https://github.com)
2. Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ð²ÑÐµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° (ÐºÑ€Ð¾Ð¼Ðµ `.venv/` Ð¸ `__pycache__/`)
3. Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ Ñ‡Ñ‚Ð¾ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ñ‹ Ñ„Ð°Ð¹Ð»Ñ‹:
   - `dashboard_app.py`
   - `revshare_pool.py`
   - `requirements.txt`
   - `readme.md`
   - `.gitignore`
   - CSV Ñ„Ð°Ð¹Ð»Ñ‹ Ñ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸

### Ð¨Ð°Ð³ 2: Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð½Ð° Streamlit Cloud

1. ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð½Ð° [share.streamlit.io](https://share.streamlit.io)
2. Ð’Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ñ‡ÐµÑ€ÐµÐ· GitHub Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚
3. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ "New app"
4. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð²Ð°Ñˆ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹
5. Ð£ÐºÐ°Ð¶Ð¸Ñ‚Ðµ:
   - **Main file path**: `dashboard_app.py`
   - **Python version**: 3.9+ (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ)
6. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ "Deploy!"

### Ð¨Ð°Ð³ 3: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)

- ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ Ð¿Ð¾ URL: `https://your-app-name.streamlit.app`
- ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÑÑ… Ð² GitHub
- Ð‘ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ð¹ Ñ…Ð¾ÑÑ‚Ð¸Ð½Ð³ Ñ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸ÑÐ¼Ð¸:
  - 1 GB RAM
  - 1 CPU core
  - Ð—Ð°ÑÑ‹Ð¿Ð°ÐµÑ‚ Ð¿Ð¾ÑÐ»Ðµ Ð½ÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸

### ÐÐ»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ñ‹ (Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ðµ)

- **Railway**: [railway.app](https://railway.app) - 500 Ñ‡Ð°ÑÐ¾Ð²/Ð¼ÐµÑÑÑ†
- **Render**: [render.com](https://render.com) - Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ð¹ Ñ‚Ð¸Ñ€
- **Heroku**: [heroku.com](https://heroku.com) - Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð½Ñ‹Ð¹ Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ð¹ Ñ‚Ð¸Ñ€

## Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ñ„Ð°Ð¹Ð»Ð¾Ð²

- `dashboard_app.py` - Ð³Ð»Ð°Ð²Ð½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» Ð´Ð°ÑˆÐ±Ð¾Ñ€Ð´Ð°
- `revshare_pool.py` - Ð»Ð¾Ð³Ð¸ÐºÐ° Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…
- `run.py` - ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…
- `requirements.txt` - Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Python
- CSV Ñ„Ð°Ð¹Ð»Ñ‹ - ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ

## Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ

1. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð² Ð±Ð¾ÐºÐ¾Ð²Ð¾Ð¹ Ð¿Ð°Ð½ÐµÐ»Ð¸
2. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ "Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ"
3. ÐÐ½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð² Ð´Ð°ÑˆÐ±Ð¾Ñ€Ð´Ðµ

## Objective
Create a Python class that generates realistic 365-day casino traffic RevShare Pool data with daily granularity, ensuring all investor tiers achieve positive returns.

## Core Parameters

### Pool Configuration
```python
pool_size: int = 35000  # USD
stable_ratio: float = 0.6  # 60% of pool
growth_ratio: float = 0.4  # 40% of pool
start_date: datetime = "2025-11-01"
duration_days: int = 365
znx_price: float = 0.60  # USD per token
```

### GGR Rates (from generated GGR)
**Stable Pool** (no token return - must return 100%+ capital):
- basic: 34% (100-4,999 ZNX invested)
- advanced: 38.25% (5,000-9,999 ZNX)
- premium: 42.5% (10,000+ ZNX) [CORRECTED from 42%]

**Growth Pool** (100% tokens returned + cash on top):
- basic: 8.5%
- advanced: 10.625%
- premium: 12.75%

### Investor Distribution (apply Pareto principle)
**Use 80/20 rule for realistic distribution:**

Stable Pool:
- basic (34%): 60% of investors, 30% of capital
- advanced (38.25%): 30% of investors, 40% of capital  
- premium (42.5%): 10% of investors, 30% of capital

Growth Pool:
- basic (8.5%): 60% of investors, 30% of capital
- advanced (10.625%): 30% of investors, 40% of capital
- premium (12.75%): 10% of investors, 30% of capital

## Traffic Acquisition (Month 1 Only)

### Traffic Spend Window
- Days 1-30: All traffic budget spent
- Days 31-365: $0 new spend, pure retention

### CPA Parameters
```python
cpa_range: tuple = (55, 75)  # USD, based on real data
# Historical reference: Aug=$54.53, Oct=$69.12, Current=$72.54
# Generate random CPA within range for each cohort
```

### FTD Calculation
```python
total_ftds = traffic_budget / random_cpa
# where random_cpa is uniformly distributed in [55, 75]
# Add daily variance: some days acquire more FTDs than others
```

### First Deposit
```python
first_deposit_range = (20, 28)  # USD
variance = 0.2  # Â±20% daily variance
```

## Retention Model

### Daily Retention Rates (from FTD date)
```python
retention_schedule = {
    (1, 30): 1.00,      # 100% during first month
    (31, 60): 0.42,     # Month 2: 42% Â±3%
    (61, 90): 0.33,     # Month 3: 33% Â±3%
    (91, 120): 0.26,    # Month 4: 26% Â±2%
    (121, 150): 0.22,   # Month 5: 22% Â±2%
    (151, 180): 0.19,   # Month 6: 19% Â±2%
    (181, 210): 0.16,   # Month 7: 16% Â±2%
    (211, 240): 0.14,   # Month 8: 14% Â±2%
    (241, 270): 0.12,   # Month 9: 12% Â±2%
    (271, 300): 0.10,   # Month 10: 10% Â±1.5%
    (301, 330): 0.09,   # Month 11: 9% Â±1.5%
    (331, 365): 0.08,   # Month 12: 8% Â±1%
}
# Apply random variance each day within specified ranges
```

## Average Deposit Growth Model

### Base Deposits by Cohort Age
```python
deposit_by_days = {
    (1, 30): 23,        # First deposits
    (31, 60): 49,       # Early retention
    (61, 90): 66,       # Growing engagement
    (91, 120): 81,      # Established players
    (121, 150): 91,     # Loyal cohort
    (151, 180): 101,    # High value
    (181, 210): 108,    # Whales emerging
    (211, 240): 115,    # Premium players
    (241, 270): 121,    # Top tier
    (271, 300): 125,    # Mature whales
    (301, 330): 129,    # Long-term high rollers
    (331, 365): 132,    # Peak value
}
# Apply variance: base * (0.85 + random(0.30))
```

### Seasonality Multipliers
```python
seasonality = {
    'christmas': {'dates': ['12-20' to '12-31'], 'mult': 1.18},
    'new_year': {'dates': ['01-01' to '01-10'], 'mult': 1.15},
    'valentines': {'date': '02-14', 'mult': 1.08},
    'world_cup': {'months': [6, 7], 'mult': 1.12},  # if applicable
    'summer_peak': {'months': [7, 8], 'mult': 1.06},
    'back_to_school': {'month': 9, 'mult': 0.92},
    'february_slump': {'month': 2, 'mult': 0.94},
    'weekends': {'days': ['Sat', 'Sun'], 'mult': 1.08},
    'paydays': {'dates': ['monthly 25-28'], 'mult': 1.12},
}
```

## GGR Calculation (Critical)

### Daily GGR Formula
```python
daily_deposits = active_players * avg_deposit_for_cohort_age
daily_ggr = daily_deposits * ggr_margin * daily_variance

ggr_margin = 0.88  # 88% house edge (constant)
daily_variance = normal_distribution(mean=1.0, std=0.05)  # Â±5% daily volatility

# GGR can be NEGATIVE on some days (players win)
# But ensure cumulative GGR trends positive
```

### Target GGR Constraint
```python
# Year-end target: cumulative_ggr â‰ˆ pool_size Ã— 3.0
# Allow variance: actual multiplier between 2.7x - 3.3x
target_ggr_range = (pool_size * 2.7, pool_size * 3.3)

# Use calibration loop to adjust parameters if needed:
# - Tune retention rates
# - Tune deposit growth curve  
# - Tune CPA to get optimal FTD count
```

## Payout Calculations

### Daily Payouts by Pool
```python
# Weighted average rates (based on capital distribution)
stable_weighted_rate = (
    0.30 * 0.34 +      # 30% capital in basic
    0.40 * 0.3825 +    # 40% capital in advanced
    0.30 * 0.425       # 30% capital in premium
) = 0.3808  # ~38.08%

growth_weighted_rate = (
    0.30 * 0.085 +     # 30% capital in basic
    0.40 * 0.10625 +   # 40% capital in advanced
    0.30 * 0.1275      # 30% capital in premium
) = 0.1069  # ~10.69%

daily_stable_payout = max(0, daily_ggr * stable_weighted_rate)
daily_growth_payout = max(0, daily_ggr * growth_weighted_rate)

# Note: If daily_ggr is negative, payouts = 0 for that day
```

### Cumulative Tracking
```python
cumulative_ggr = sum(daily_ggr for all days)
cumulative_stable = sum(daily_stable_payout)
cumulative_growth = sum(daily_growth_payout)

stable_return_pct = (cumulative_stable / stable_pool_size) * 100
growth_return_pct = (cumulative_growth / growth_pool_size) * 100
```

## Output Requirements

### Daily DataFrame Columns
```python
columns = [
    'date',                    # datetime
    'day',                     # 1-365
    'month',                   # 1-12
    'day_of_week',            # Mon-Sun
    'new_ftds',               # int (only Days 1-30)
    'active_players',         # int
    'avg_deposit',            # float
    'total_deposits',         # float
    'daily_ggr',              # float (can be negative!)
    'cumulative_ggr',         # float
    'stable_payout',          # float
    'growth_payout',          # float
    'cumulative_stable',      # float
    'cumulative_growth',      # float
    'stable_return_pct',      # float
    'growth_return_pct',      # float (cash only)
    'traffic_spend',          # float (only Days 1-30)
    'cumulative_traffic',     # float
    'ggr_multiplier',         # cumulative_ggr / pool_size
]
```

### Tier-Level Returns Output
```python
# Must show per-dollar returns for each tier
tier_returns = {
    'stable': {
        'basic': {
            'invested': float,
            'received': float,
            'return_pct': float,  # Must be >100% (includes capital)
            'profit_pct': float,   # Return - 100%
            'per_dollar': float,   # received / invested
        },
        'advanced': {...},
        'premium': {...},
    },
    'growth': {
        'basic': {
            'invested': float,
            'cash_received': float,
            'tokens_returned': float,  # 100% of invested ZNX
            'cash_return_pct': float,
            'total_return_pct': float,  # if ZNX price stays same
            'per_dollar_cash': float,
            'per_dollar_total': float,  # including token value
        },
        'advanced': {...},
        'premium': {...},
    }
}

# VALIDATION: Every tier must show positive returns
# Stable basic (34%): must achieve >100% return
# All others: must show meaningful profit
```

## Class Structure

```python
class RevSharePoolGenerator:
    def __init__(
        self,
        pool_size: int = 35000,
        stable_ratio: float = 0.6,
        growth_ratio: float = 0.4,
        traffic_budget: int = 35000,
        start_date: str = "2025-11-01",
        cpa_range: tuple = (55, 75),
        target_ggr_multiplier: float = 3.0,
        seed: int = None  # for reproducibility
    ):
        """Initialize pool generator with configuration"""
        
    def _calculate_investor_distribution(self) -> dict:
        """Apply Pareto distribution to investor tiers"""
        
    def _generate_ftd_schedule(self) -> pd.DataFrame:
        """Generate FTD acquisition for Days 1-30"""
        
    def _get_retention_rate(self, days_since_ftd: int) -> float:
        """Get retention rate with variance for specific day"""
        
    def _get_avg_deposit(self, days_since_ftd: int, date: datetime) -> float:
        """Calculate average deposit with cohort age and seasonality"""
        
    def _calculate_seasonality(self, date: datetime) -> float:
        """Return seasonality multiplier for given date"""
        
    def _calculate_daily_ggr(self, active_players: int, avg_deposit: float) -> float:
        """Calculate daily GGR with house edge and variance"""
        
    def generate_daily_data(self) -> pd.DataFrame:
        """
        Main generation method - produces 365 days of data
        Returns DataFrame with all required columns
        """
        
    def calibrate_to_target_ggr(self, tolerance: float = 0.1) -> None:
        """
        Iteratively adjust parameters to hit target GGR multiplier
        Tolerance: acceptable deviation from target (e.g., 0.1 = Â±10%)
        """
        
    def calculate_tier_returns(self) -> dict:
        """
        Calculate final returns for each investor tier
        Ensures all tiers show positive returns
        """
        
    def get_monthly_summary(self) -> pd.DataFrame:
        """Aggregate daily data into monthly view"""
        
    def validate_results(self) -> dict:
        """
        Validate generated data:
        - GGR multiplier in target range
        - All tiers profitable
        - Monotonic cumulative metrics
        - No impossible values
        """
        
    def export_to_csv(self, prefix: str = "pool1") -> None:
        """Export daily data and summaries to CSV files"""
        
    def plot_dashboard(self, save_path: str = None) -> None:
        """
        Create visualization dashboard:
        - Daily GGR over time
        - Active players decay
        - Cumulative returns by pool
        - Tier comparison
        """
```

## Calibration Algorithm

```python
def calibrate_to_target_ggr(self, tolerance=0.1):
    """
    Iterative calibration to achieve target GGR multiplier
    
    Steps:
    1. Generate initial data with default parameters
    2. Check cumulative GGR vs target
    3. If too low: increase retention OR deposits OR FTDs
    4. If too high: decrease retention OR deposits OR FTDs
    5. Repeat until within tolerance
    
    Priority adjustments (in order):
    - FTD count (adjust CPA to control acquisition)
    - Retention rates (boost/reduce by Â±5%)
    - Deposit growth curve (scale up/down by Â±10%)
    """
    max_iterations = 20
    for iteration in range(max_iterations):
        daily_data = self.generate_daily_data()
        actual_multiplier = daily_data['cumulative_ggr'].iloc[-1] / self.pool_size
        
        if abs(actual_multiplier - self.target_ggr_multiplier) < tolerance:
            break
            
        # Adjust parameters based on deviation
        # ...
```

## Validation Rules

### Must-Pass Checks
1. **GGR Multiplier**: 2.7x â‰¤ final_ggr/pool_size â‰¤ 3.3x
2. **Stable Returns**: All tiers > 100% (basic must clear 100%+ minimum)
3. **Growth Returns**: All tiers show positive cash + tokens
4. **Monotonic Cumulative**: cumulative_ggr never decreases
5. **Active Players**: Only decrease after Day 30 (no new acquisition)
6. **No Negatives**: No negative active_players or cumulative values
7. **Payout Ratio**: total_payouts < cumulative_ggr (can't pay more than earned)

### Per-Tier Profitability
```python
# Minimum acceptable returns:
stable_basic_min = 1.15      # 115% (100% capital + 15% profit)
stable_advanced_min = 1.22   # 122%
stable_premium_min = 1.30    # 130%

growth_basic_min = 0.15      # 15% cash (plus 100% tokens)
growth_advanced_min = 0.20   # 20% cash
growth_premium_min = 0.27    # 27% cash
```

## Usage Example

```python
# Initialize generator
gen = RevSharePoolGenerator(
    pool_size=35000,
    traffic_budget=35000,
    start_date="2025-11-01",
    cpa_range=(55, 75),
    target_ggr_multiplier=2.9,
    seed=42
)

# Auto-calibrate
gen.calibrate_to_target_ggr(tolerance=0.1)

# Generate data
daily_df = gen.generate_daily_data()
monthly_df = gen.get_monthly_summary()
tier_returns = gen.calculate_tier_returns()

# Validate
validation = gen.validate_results()
assert validation['passed'], f"Validation failed: {validation['errors']}"

# Export
gen.export_to_csv(prefix="pool1_nov2025")

# Print summary
print(f"Final GGR: ${daily_df['cumulative_ggr'].iloc[-1]:,.0f}")
print(f"Multiplier: {daily_df['ggr_multiplier'].iloc[-1]:.2f}x")
print("\nStable Pool Returns:")
for tier, data in tier_returns['stable'].items():
    print(f"  {tier}: {data['return_pct']:.1f}% (${data['per_dollar']:.2f} per $1)")
print("\nGrowth Pool Returns (cash):")
for tier, data in tier_returns['growth'].items():
    print(f"  {tier}: {data['cash_return_pct']:.1f}% + tokens (${data['per_dollar_cash']:.2f} per $1)")
```

## Additional Features

### Scenario Comparison
```python
def compare_scenarios(configs: List[dict]) -> pd.DataFrame:
    """Compare multiple pool configurations side-by-side"""
```

### Sensitivity Analysis
```python
def sensitivity_analysis(parameter: str, range: tuple) -> dict:
    """Test impact of parameter changes on final returns"""
```

### Referral Costs (Optional)
```python
referral_config = {
    'percentage': 0.30,  # 30% of investors via referral
    'upfront_bonus': 0.03,  # 3% of investment
    'monthly_share_stable': 0.04,  # 4% of monthly payout
    'monthly_share_growth': 0.15,  # 15% of monthly payout
}
# Subtract referral costs from business margin
```

---

## ðŸ”’ Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ

ÐŸÑ€Ð¾ÐµÐºÑ‚ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½ Ñ ÑƒÑ‡ÐµÑ‚Ð¾Ð¼ Ð»ÑƒÑ‡ÑˆÐ¸Ñ… Ð¿Ñ€Ð°ÐºÑ‚Ð¸Ðº Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸:

- âœ… Ð’ÑÐµ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ñ‹ Ð¸Ð· Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ
- âœ… ÐÐ°ÑÑ‚Ñ€Ð¾ÐµÐ½ `.gitignore` Ð´Ð»Ñ Ð·Ð°Ñ‰Ð¸Ñ‚Ñ‹ ÐºÐ¾Ð½Ñ„Ð¸Ð´ÐµÐ½Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸
- âœ… ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Streamlit Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð° Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð°
- âœ… ÐžÑ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð° ÑÐ±Ð¾Ñ€ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ

## ðŸ“ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°

```
calculator/
â”œâ”€â”€ dashboard_app.py          # ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Streamlit
â”œâ”€â”€ revshare_pool.py         # Ð›Ð¾Ð³Ð¸ÐºÐ° Ñ€Ð°ÑÑ‡ÐµÑ‚Ð¾Ð² Ð¿ÑƒÐ»Ð¾Ð²
â”œâ”€â”€ requirements.txt         # Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Python
â”œâ”€â”€ readme.md               # Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ
â”œâ”€â”€ .gitignore              # Ð˜ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Git
â”œâ”€â”€ .streamlit/             # ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Streamlit
â”‚   â”œâ”€â”€ config.toml         # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
â”‚   â””â”€â”€ secrets.toml        # Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ (Ð½Ðµ Ð² Git)
â”œâ”€â”€ project_analysis.md     # Ð¢ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ
â””â”€â”€ *.csv                   # ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…
```

## ðŸ¤ Ð’ÐºÐ»Ð°Ð´ Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚

1. Ð¤Ð¾Ñ€ÐºÐ½Ð¸Ñ‚Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹
2. Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð²ÐµÑ‚ÐºÑƒ Ð´Ð»Ñ Ð½Ð¾Ð²Ð¾Ð¹ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ (`git checkout -b feature/amazing-feature`)
3. Ð—Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ (`git commit -m 'Add amazing feature'`)
4. ÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ Ð² Ð²ÐµÑ‚ÐºÑƒ (`git push origin feature/amazing-feature`)
5. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Pull Request

## ðŸ“„ Ð›Ð¸Ñ†ÐµÐ½Ð·Ð¸Ñ

Ð­Ñ‚Ð¾Ñ‚ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ñ€Ð°ÑÐ¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ Ð¿Ð¾Ð´ Ð»Ð¸Ñ†ÐµÐ½Ð·Ð¸ÐµÐ¹ MIT. Ð¡Ð¼. Ñ„Ð°Ð¹Ð» `LICENSE` Ð´Ð»Ñ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ð¾ÑÑ‚ÐµÐ¹.

## ðŸ“ž ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°

Ð•ÑÐ»Ð¸ Ñƒ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¸Ð»Ð¸ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ, ÑÐ¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ [Issue](https://github.com/DaniilKozin/calculator/issues) Ð² Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸.

---

## Key Requirements Summary

1. âœ… 365 daily rows with all metrics
2. âœ… GGR can be negative on individual days
3. âœ… Cumulative GGR ~3x pool size (Â±10%)
4. âœ… CPA random in [55, 75] range
5. âœ… Traffic only in Days 1-30
6. âœ… Pareto distribution for investor tiers
7. âœ… All tiers must be profitable
8. âœ… Stable basic (34%) must return >100%
9. âœ… Per-dollar returns for each tier
10. âœ… Auto-calibration to hit target GGR
11. âœ… CSV export capability
12. âœ… Validation checks

Build this class with proper type hints, docstrings, and error handling!